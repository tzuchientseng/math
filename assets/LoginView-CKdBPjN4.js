import{e as S,d as w,f as c,c as a,u as p,a as n,t as v,g as b,w as _,v as f,h as I,i as L,o as r,_ as U}from"./index-D08CSPPq.js";const N="https://home.sunnytseng.com/api/math-api/token/",x=S("auth",{state:()=>({user:JSON.parse(sessionStorage.getItem("user")||"null"),token:sessionStorage.getItem("token")||null}),getters:{isAuthenticated:e=>!!e.token,getUserName:e=>{var s;return((s=e.user)==null?void 0:s.name)??"Guest"}},actions:{async login(e,s){try{const t=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:s})});if(!t.ok)throw new Error("Login failed");const o=await t.json(),i={name:o.name,account:o.account,avatar:o.avatar,token:o.access};return this.setUser(i),{success:!0}}catch(t){return t instanceof Error?(console.error("Login error:",t.message),{success:!1,message:t.message}):(console.error("Unknown error:",t),{success:!1,message:"An unknown error occurred"})}},setUser(e){this.user=e,this.token=e.token,sessionStorage.setItem("user",JSON.stringify(e)),sessionStorage.setItem("token",e.token||"")},setToken(e){this.token=e,sessionStorage.setItem("token",e)},logout(){this.user=null,this.token=null,sessionStorage.removeItem("user"),sessionStorage.removeItem("token")}}}),A={class:"auth-container"},V={key:0,class:"user-info"},C=["src"],O={key:1,class:"login-box"},T={type:"submit"},B={key:0,class:"spinner"},E={key:1},J={key:0,class:"error-message"},M=w({__name:"LoginView",setup(e){const s=x(),t=L(),o=c(""),i=c(""),l=c(""),d=c(!1),k=async()=>{d.value=!0;const m=await s.login(o.value,i.value);m.success||(l.value=m.message??"登入失敗"),d.value=!1},y=()=>{s.logout(),t.push("/")};return(m,u)=>{var h;return r(),a("div",A,[p(s).isAuthenticated?(r(),a("div",V,[n("img",{src:(h=p(s).user)==null?void 0:h.avatar,alt:"Avatar",class:"avatar"},null,8,C),n("span",null,v(p(s).getUserName),1),n("button",{onClick:y},"登出")])):(r(),a("div",O,[n("form",{onSubmit:I(k,["prevent"])},[_(n("input",{"onUpdate:modelValue":u[0]||(u[0]=g=>o.value=g),type:"text",placeholder:"帳號",required:""},null,512),[[f,o.value]]),_(n("input",{"onUpdate:modelValue":u[1]||(u[1]=g=>i.value=g),type:"password",placeholder:"密碼",required:""},null,512),[[f,i.value]]),n("button",T,[d.value?(r(),a("span",B)):(r(),a("span",E,"登入"))])],32),l.value?(r(),a("p",J,v(l.value),1)):b("",!0)]))])}}}),q=U(M,[["__scopeId","data-v-25ebe3bb"]]);export{q as default};
